<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blocky Debate - AI å¥‡è‘©è¯´ (Pro)</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è°·æ­Œå­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@900&display=swap" rel="stylesheet">
    
    <style>
        /* --- å…¨å±€è®¾ç½® --- */
        body {
            background-color: #121212;
            font-family: 'Noto Sans SC', sans-serif;
            overflow: hidden;
            color: white;
            perspective: 1000px;
        }

        /* --- å¥‡è‘©è¯´å­—å¹• (ä¿ç•™ç»å…¸é£æ ¼) --- */
        .qipa-subtitle {
            font-size: 3rem;
            line-height: 1.1;
            font-weight: 900;
            text-align: center;
            color: #FFD700; 
            -webkit-text-stroke: 3px #000;
            text-shadow: 4px 4px 0px #000, -2px -2px 0px rgba(255,255,255,0.3);
            transform: rotate(-2deg);
            transition: all 0.2s;
            opacity: 0;
            transform-origin: center bottom;
            pointer-events: none;
        }
        .qipa-subtitle.active { opacity: 1; transform: rotate(-2deg) scale(1); }

        .highlight-word {
            display: inline-block;
            color: #FF4D4F;
            -webkit-text-stroke: 3px white;
            font-size: 1.2em;
            transform: rotate(5deg) scale(1.1);
            margin: 0 5px;
            animation: pulse-word 0.5s infinite alternate;
        }
        @keyframes pulse-word {
            from { transform: rotate(5deg) scale(1.1); }
            to { transform: rotate(3deg) scale(1.2); }
        }

        /* --- 3D èˆå°å®¹å™¨ --- */
        .scene-3d {
            transform-style: preserve-3d;
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        
        /* å¼€æ æ—¶é•œå¤´ä¸éœ€è¦å¤§åŠ¨ï¼Œå› ä¸ºäººä¼šèµ°è¿‡æ¥ï¼Œä½†å¯ä»¥å¾®è°ƒè§†è§’ */
        .scene-3d.kaigang-mode {
            transform: scale(1.1) translateY(5%); 
        }

        /* --- è§’è‰²å®¹å™¨ (æ ¸å¿ƒåŠ¨ç”»å±‚) --- */
        .voxel-debater {
            position: absolute;
            width: 100px;
            height: 140px; /* åŒ…å«èº«ä½“é«˜åº¦ */
            transform-style: preserve-3d;
            /* å…³é”®ï¼šä½¿ç”¨ left/bottom/transform çš„å¹³æ»‘è¿‡æ¸¡æ¥å®ç°èµ°ä½ */
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* --- æ–¹å—äººæ„é€  --- */
        .head-cube {
            width: 80px;
            height: 80px;
            position: absolute;
            left: 10px;
            top: 0;
            transform-style: preserve-3d;
            animation: head-bob 3s infinite ease-in-out;
        }

        @keyframes head-bob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .face {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 3px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 45px;
            background: #f1c40f; /* é»˜è®¤è‚¤è‰² */
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        }

        .face--front  { transform: rotateY(  0deg) translateZ(40px); }
        .face--right  { transform: rotateY( 90deg) translateZ(40px); background: #e67e22; }
        .face--back   { transform: rotateY(180deg) translateZ(40px); background: #333; } /* åè„‘å‹ºå¤´å‘ */
        .face--left   { transform: rotateY(-90deg) translateZ(40px); background: #e67e22; }
        .face--top    { transform: rotateX( 90deg) translateZ(40px); background: #333; } /* å¤´é¡¶å¤´å‘ */
        .face--bottom { transform: rotateX(-90deg) translateZ(40px); background: #333; }

        /* èº«ä½“ */
        .body-block {
            width: 60px;
            height: 50px;
            background: #333;
            position: absolute;
            top: 80px;
            left: 20px;
            transform: translateZ(0px); /* èº«ä½“ç¨å¾®é åä¸€ç‚¹ç‚¹æˆ–è€…å±…ä¸­ */
            border: 3px solid black;
            transform-style: preserve-3d;
        }

        /* è¡£æœé¢œè‰² */
        .red-team .body-block { background: #E74C3C; }
        .blue-team .body-block { background: #3498DB; }
        .host-team .body-block { background: #8E44AD; }

        /* å°æ‰‹ (å¢åŠ æ‹Ÿäººæ„Ÿ) */
        .hand {
            width: 15px;
            height: 30px;
            background: #f1c40f;
            border: 2px solid black;
            position: absolute;
            top: 10px;
            transition: all 0.2s;
        }
        .hand.left { left: -10px; transform-origin: top right; }
        .hand.right { right: -10px; transform-origin: top left; }

        /* è¯´è¯æ—¶æ‰‹èˆè¶³è¹ˆ */
        .speaking .hand.left { animation: wave-left 0.5s infinite alternate; }
        .speaking .hand.right { animation: wave-right 0.5s infinite alternate-reverse; }

        @keyframes wave-left { from { transform: rotate(0deg); } to { transform: rotate(45deg); } }
        @keyframes wave-right { from { transform: rotate(0deg); } to { transform: rotate(-45deg); } }

        /* é˜´å½± */
        .shadow {
            width: 80px;
            height: 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            position: absolute;
            bottom: -10px;
            left: 10px;
            transform: rotateX(90deg) translateZ(-50px);
            filter: blur(5px);
        }

        /* æ‚¬æµ®åç‰Œ (å¤´é¡¶) */
        .name-tag-floating {
            position: absolute;
            top: -40px; /* åœ¨å¤´é¡¶ä¸Šæ–¹ */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 10px;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid white;
            border-radius: 4px;
            white-space: nowrap;
            z-index: 200;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            /* ç¡®ä¿åç‰Œå§‹ç»ˆé¢å‘å±å¹•ï¼Œä¸éšèº«ä½“æ—‹è½¬ */
            /* ä½†è¿™é‡Œæˆ‘ä»¬é€šè¿‡æ§åˆ¶çˆ¶å®¹å™¨æ—‹è½¬ï¼Œåç‰Œæœ¬èº«ä¸éœ€è¦åå‘æ—‹è½¬ï¼Œå› ä¸ºçˆ¶å®¹å™¨ä¸»è¦åšä½ç§» */
        }
        
        .red-team .name-tag-floating { border-color: #FF4D4F; color: #FF4D4F; background: black; }
        .blue-team .name-tag-floating { border-color: #1890FF; color: #1890FF; background: black; }

        /* --- å¼€æ /å¥‡è¢­ ç‰¹æ•ˆå±‚ --- */
        .kaigang-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10; /* åœ¨èƒŒæ™¯ä¹‹ä¸Šï¼Œä½†åœ¨è¾©æ‰‹ä¹‹ä¸‹(å¦‚æœè¾©æ‰‹zindexé«˜) */
            pointer-events: none;
        }
        
        .kaigang-bolt {
            width: 20px;
            height: 100vh;
            background: yellow;
            box-shadow: 0 0 50px yellow;
            transform: rotate(15deg);
            animation: bolt-flicker 0.1s infinite;
        }
        @keyframes bolt-flicker {
            0% { opacity: 1; transform: rotate(15deg) scaleX(1); }
            50% { opacity: 0.5; transform: rotate(15deg) scaleX(1.5); }
            100% { opacity: 1; transform: rotate(15deg) scaleX(0.8); }
        }

    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åæ ‡ç³»ç»Ÿ ---
        // å®šä¹‰æ¯ä¸ªåº§ä½çš„å›ºå®šä½ç½® (Bottom, Left/Right)
        const SEATS = {
            'r3': { bottom: '50%', left: '15%', zIndex: 10, scale: 0.8 },
            'r2': { bottom: '35%', left: '10%', zIndex: 20, scale: 0.9 },
            'r1': { bottom: '15%', left: '5%',  zIndex: 30, scale: 1.0 },
            
            'b3': { bottom: '50%', right: '15%', zIndex: 10, scale: 0.8 },
            'b2': { bottom: '35%', right: '10%', zIndex: 20, scale: 0.9 },
            'b1': { bottom: '15%', right: '5%',  zIndex: 30, scale: 1.0 },
            
            'host': { bottom: '60%', left: '46%', zIndex: 5, scale: 0.8 }
        };

        // å®šä¹‰â€œèˆå°ä¸­å¤®â€åæ ‡ (ç”¨äºå‘è¨€æ—¶èµ°ä½)
        const CENTER_STAGE = { bottom: '20%', left: '50%', transform: 'translateX(-50%)', scale: 1.5, zIndex: 100 };
        
        // å®šä¹‰â€œå¼€æ â€åæ ‡ (ä¸¤äººå¯¹å³™)
        const KAIGANG_LEFT = { bottom: '20%', left: '35%', scale: 1.4, zIndex: 100, rotateY: '45deg' };
        const KAIGANG_RIGHT = { bottom: '20%', left: '65%', scale: 1.4, zIndex: 100, rotateY: '-45deg' };

        // åˆå§‹è¾©æ‰‹æ•°æ®
        const INITIAL_DEBATERS = [
            { id: 'host', name: 'é©¬ä¸œä¸œ', side: 'host', face: 'ğŸ¤“' },
            { id: 'r3', name: 'ä¸‰è¾©Â·ç…½æƒ…', side: 'red', face: 'ğŸ˜' },
            { id: 'r2', name: 'äºŒè¾©Â·æ•°æ®', side: 'red', face: 'ğŸ˜' },
            { id: 'r1', name: 'ä¸€è¾©Â·æš´èº', side: 'red', face: 'ğŸ˜' },
            { id: 'b3', name: 'ä¸‰è¾©Â·å“²å­¦', side: 'blue', face: 'ğŸ˜' },
            { id: 'b2', name: 'äºŒè¾©Â·æ ç²¾', side: 'blue', face: 'ğŸ˜' },
            { id: 'b1', name: 'ä¸€è¾©Â·ç»¿èŒ¶', side: 'blue', face: 'ğŸ˜' },
        ];

        const SCRIPT = [
            { 
                speaker: 'host', 
                text: "æ¬¢è¿æ¥åˆ°<span class='highlight-word'>èµ›åšå¥‡è‘©è¯´</span>ï¼",
                emotion: 'ğŸ¤“',
                duration: 3000
            },
            { 
                speaker: 'r1', 
                text: "è¿™é“é¢˜ç®€ç›´å°±æ˜¯<span class='highlight-word'>è’è°¬</span>ï¼ä»€ä¹ˆå«è¯¥ä¸è¯¥ï¼Ÿ",
                emotion: 'ğŸ˜¡',
                duration: 3000
            },
            { 
                speaker: 'r2', 
                text: "å¤§æ•°æ®æ˜¾ç¤ºï¼Œ<span class='highlight-word'>99.8%</span>çš„æ‰“å·¥äººéƒ½æƒ³æ‹’ç»å·¥ä½œï¼",
                emotion: 'ğŸ¤–',
                duration: 3500
            },
            { 
                speaker: 'b1', 
                text: "å“å“Ÿå–‚ï¼Œæ•°æ®æ˜¯å†·çš„ï¼Œ<span class='highlight-word'>äººå¿ƒ</span>æ˜¯çƒ­çš„å˜›~",
                emotion: 'ğŸ˜',
                duration: 3000
            },
            { 
                type: 'KAIGANG', 
                speakerA: 'r1', // æš´èº
                speakerB: 'b2', // æ ç²¾
                duration: 1000 // è¿›åœºæ—¶é—´
            },
            { 
                speaker: 'b2', 
                text: "ä¸å·¥ä½œä½ <span class='highlight-word'>åƒä»€ä¹ˆ</span>ï¼Ÿï¼",
                emotion: 'ğŸ¤¡',
                kaigang: true,
                duration: 2500
            },
            { 
                speaker: 'r1', 
                text: "åƒ<span class='highlight-word'>è½¯é¥­</span>è¡Œä¸è¡Œï¼Ÿï¼",
                emotion: 'ğŸ˜',
                kaigang: true,
                duration: 2000
            },
             { 
                speaker: 'b2', 
                text: "ä½ ä¹Ÿè¦æœ‰é‚£å¼ <span class='highlight-word'>è„¸</span>å•Šï¼",
                emotion: 'ğŸ˜±',
                kaigang: true,
                duration: 3000
            }
        ];

        // --- ç»„ä»¶ï¼šVoxel Debater (äººå½¢æ€æ–¹å—) ---
        const VoxelDebater = ({ id, data, isSpeaking, positionData, emotion }) => {
            // åˆå¹¶å½“å‰çš„ä½ç½®æ ·å¼
            const style = {
                bottom: positionData.bottom,
                left: positionData.left,
                right: positionData.right,
                zIndex: positionData.zIndex,
                transform: `${positionData.transform || ''} scale(${positionData.scale})`,
            };

            // è„¸éƒ¨è¡¨æƒ… (å¦‚æœä¼ å…¥äº†å½“å‰emotionä¸”æ­£åœ¨è¯´è¯ï¼Œç”¨æ–°çš„ï¼Œå¦åˆ™ç”¨é»˜è®¤)
            const currentFace = (isSpeaking && emotion) ? emotion : data.face;

            // æ—‹è½¬é€»è¾‘ï¼šå¦‚æœåœ¨å¼€æ ï¼Œå¼ºåˆ¶å¯¹è§†ï¼›å¦åˆ™æ ¹æ®é˜µè¥å¾®è°ƒæœå‘
            let rotateY = positionData.rotateY || '0deg';
            if (!positionData.rotateY) {
                 if (data.side === 'red') rotateY = '20deg';
                 if (data.side === 'blue') rotateY = '-20deg';
                 if (isSpeaking) rotateY = '0deg'; // å‘è¨€æ—¶æ­£å¯¹é•œå¤´
            }

            return (
                <div 
                    className={`voxel-debater ${data.side}-team ${isSpeaking ? 'speaking' : ''}`}
                    style={style}
                >
                    {/* å¤´éƒ¨ */}
                    <div className="head-cube" style={{ transform: `rotateX(-10deg) rotateY(${rotateY})` }}>
                        <div className="face face--front">{currentFace}</div>
                        <div className="face face--back"></div>
                        <div className="face face--right"></div>
                        <div className="face face--left"></div>
                        <div className="face face--top"></div>
                        <div className="face face--bottom"></div>
                        
                        {/* æ‚¬æµ®åç‰Œ (è·Ÿéšå¤´éƒ¨ä½ç½®) */}
                        <div className="name-tag-floating">
                            {data.name}
                        </div>
                    </div>

                    {/* èº«ä½“ */}
                    <div className="body-block" style={{ transform: `rotateY(${rotateY})` }}>
                         {/* å°æ‰‹ */}
                         <div className="hand left"></div>
                         <div className="hand right"></div>
                    </div>
                    
                    {/* å½±å­ */}
                    <div className="shadow"></div>

                    {/* è¯´è¯æ°”æ³¡ */}
                    {isSpeaking && (
                        <div className="absolute -top-24 left-1/2 transform -translate-x-1/2 text-4xl animate-bounce z-50">
                            {data.side === 'host' ? 'ğŸ¤' : 'ğŸ’¬'}
                        </div>
                    )}
                </div>
            );
        };

        // --- ä¸»ç¨‹åº ---
        const App = () => {
            const [lineIndex, setLineIndex] = useState(-1);
            const [isPlaying, setIsPlaying] = useState(false);
            const [kaigangInfo, setKaigangInfo] = useState(null); // { a: 'id', b: 'id' }
            const [votes, setVotes] = useState({ red: 50, blue: 50 });

            useEffect(() => {
                if (!isPlaying) return;
                if (lineIndex >= SCRIPT.length) { setIsPlaying(false); return; }

                const line = SCRIPT[lineIndex];
                
                // å¤„ç†å¼€æ çŠ¶æ€
                if (line.type === 'KAIGANG') {
                    setKaigangInfo({ a: line.speakerA, b: line.speakerB });
                }
                
                // æ¨¡æ‹Ÿç¥¨æ•°
                if (line.speaker && line.speaker !== 'host') {
                    const shift = Math.floor(Math.random() * 8) - 4;
                    setVotes(v => ({ red: v.red + shift, blue: v.blue - shift }));
                }

                const timer = setTimeout(() => {
                    setLineIndex(prev => prev + 1);
                }, line.duration);
                return () => clearTimeout(timer);
            }, [lineIndex, isPlaying]);

            const startDebate = () => {
                setLineIndex(0);
                setIsPlaying(true);
                setKaigangInfo(null);
            };

            const currentLine = SCRIPT[lineIndex];
            const activeSpeaker = currentLine?.speaker;
            
            // è®¡ç®—æ¯ä¸ªäººçš„ä½ç½®
            const getDebaterPosition = (id) => {
                // 1. å¦‚æœæ˜¯å¼€æ æ¨¡å¼ï¼Œä¸”æ˜¯å½“äº‹äºº
                if (kaigangInfo) {
                    if (id === kaigangInfo.a) return KAIGANG_LEFT;
                    if (id === kaigangInfo.b) return KAIGANG_RIGHT;
                    // å…¶ä»–äººå˜æš—æˆ–æ·¡å‡º? è¿™é‡Œæš‚æ—¶ä¿æŒåŸä½
                }

                // 2. å¦‚æœæ˜¯å½“å‰å‘è¨€äºº (ä¸”ä¸æ˜¯å¼€æ æ¨¡å¼)
                if (activeSpeaker === id && !kaigangInfo) {
                    return CENTER_STAGE;
                }

                // 3. é»˜è®¤åº§ä½
                return SEATS[id] || SEATS['host'];
            };

            return (
                <div className="w-screen h-screen flex flex-col relative overflow-hidden bg-gray-900">
                    
                    {/* é¡¶éƒ¨æ  */}
                    <div className="absolute top-0 w-full z-40 bg-yellow-400 border-b-4 border-black p-4 flex justify-between items-center shadow-lg">
                         <div className="bg-black text-white px-2 font-bold transform -skew-x-12">LIVE</div>
                         <h1 className="text-xl md:text-3xl font-black text-black uppercase truncate">
                            è¾©é¢˜ï¼šAI è¯¥ä¸è¯¥æœ‰â€œæ‹’ç»å·¥ä½œâ€çš„æƒåˆ©ï¼Ÿ
                        </h1>
                        <button onClick={startDebate} className="bg-black text-white px-4 py-1 font-bold border-2 border-white hover:scale-105 transition">
                            {isPlaying ? 'ON AIR' : 'START'}
                        </button>
                    </div>

                    {/* ç¥¨æ•°æ¡ */}
                    <div className="absolute top-20 w-full flex justify-center z-30">
                        <div className="flex w-2/3 h-8 border-2 border-white transform -skew-x-12 shadow-lg">
                            <div className="bg-red-500 flex items-center pl-2 font-bold text-white transition-all duration-500" style={{width: `${votes.red}%`}}>{votes.red}</div>
                            <div className="bg-blue-500 flex items-center justify-end pr-2 font-bold text-white flex-1 transition-all duration-500">{votes.blue}</div>
                        </div>
                    </div>

                    {/* 3D èˆå° */}
                    <div className={`scene-3d ${kaigangInfo ? 'kaigang-mode' : ''}`}>
                        {/* åœ°æ¿ */}
                        <div className="absolute bottom-0 w-full h-1/2 bg-gray-800" 
                             style={{ 
                                 background: 'repeating-linear-gradient(45deg, #1f1f1f 0, #1f1f1f 40px, #2a2a2a 40px, #2a2a2a 80px)',
                                 transform: 'rotateX(60deg) scale(2.5)',
                                 transformOrigin: 'bottom'
                             }}>
                        </div>
                        
                        {/* å¼€æ é—ªç”µç‰¹æ•ˆ */}
                        {kaigangInfo && (
                            <div className="kaigang-overlay">
                                <div className="kaigang-bolt"></div>
                            </div>
                        )}

                        {/* æ¸²æŸ“æ‰€æœ‰è¾©æ‰‹ */}
                        {INITIAL_DEBATERS.map(d => (
                            <VoxelDebater 
                                key={d.id} 
                                id={d.id}
                                data={d} 
                                isSpeaking={activeSpeaker === d.id}
                                emotion={currentLine?.emotion}
                                positionData={getDebaterPosition(d.id)}
                            />
                        ))}
                    </div>

                    {/* å­—å¹• */}
                    <div className="absolute bottom-12 w-full px-4 flex justify-center z-50">
                         {currentLine && currentLine.text && (
                            <div 
                                key={lineIndex}
                                className="qipa-subtitle active"
                                dangerouslySetInnerHTML={{ __html: currentLine.text }}
                            >
                            </div>
                        )}
                    </div>
                    
                    {/* è§‚ä¼—å‰ªå½± */}
                    <div className="absolute bottom-0 w-full h-32 bg-gradient-to-t from-black to-transparent z-40 pointer-events-none"></div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>